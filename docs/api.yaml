basePath: /
host: localhost:3344
info:
  description: Backend of repo https://github.com/vidorg/vid_vue
  license:
    name: MIT
    url: https://github.com/vidorg/vid_backend/blob/master/LICENSE
  termsOfService: https://github.com/vidorg
  title: vid backend
  version: '1.1'
paths:
  /auth/:
    get:
      consumes:
      - multipart/form-data
      description: 根据认证令牌，查看当前登录用户
      operationId: -auth-get
      parameters:
      - &id001
        description: 用户登录令牌
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n       \"code\": 200,\n       \"message\": \"\
            success\",\n       \"data\": {\n        \"uid\": 10,\n        \"username\"\
            : \"aoihosizora\",\n        \"sex\": \"unknown\",\n        \"profile\"\
            : \"\",\n        \"avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\"\
            ,\n        \"birth_time\": \"2000-01-01\",\n        \"authority\": \"\
            normal\"\n        \"phone_number\": \"13512345678\"\n       }\n      \
            \ }\n```"
        '401': &id002
          description: '"authorization failed" / "token has expired"'
      security:
      - basicAuth: ''
      summary: 查看当前登录用户
      tags:
      - Authorization
  /auth/login:
    post:
      consumes:
      - multipart/form-data
      description: 用户登录
      operationId: -auth-login-post
      parameters:
      - description: 用户名
        in: formData
        name: username
        required: true
        type: string
      - description: 用户密码
        in: formData
        name: password
        required: true
        type: string
      - description: 登录有效期，默认为七天
        in: formData
        name: expire
        required: false
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n       \"code\": 200,\n       \"message\": \"\
            success\",\n       \"data\": {\n        \"user\": {\n         \"uid\"\
            : 10,\n         \"username\": \"aoihosizora\",\n         \"sex\": \"unknown\"\
            ,\n         \"profile\": \"\",\n         \"avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\"\
            ,\n         \"birth_time\": \"2000-01-01\",\n         \"authority\": \"\
            normal\"\n         \"phone_number\": \"13512345678\"\n        },\n   \
            \     \"token\": \"Bearer xxx\",\n        \"expire\": 604800\n       }\n\
            \       }\n```"
        '400':
          description: '"request param error"'
        '401':
          description: '"password error"'
        '404':
          description: '"user not found"'
        '500':
          description: '"login failed"'
      summary: 登录
      tags:
      - Authorization
  /auth/password:
    put:
      consumes:
      - multipart/form-data
      description: 用户修改密码
      operationId: -auth-password-put
      parameters:
      - *id001
      - description: '用户密码

          *Minimum length* : 8

          *Maximum length* : 30'
        in: formData
        maxLength: 30
        minLength: 8
        name: password
        required: true
        type: string
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            \n}\n```"
        '400':
          description: '"request param error" / "request format error"'
        '401': *id002
        '404':
          description: '"user not found"'
        '500':
          description: '"update password failed"'
      security:
      - basicAuth: ''
      summary: 修改密码
      tags:
      - Authorization
  /auth/register:
    post:
      consumes:
      - multipart/form-data
      description: 用户注册
      operationId: -auth-register-post
      parameters:
      - description: '用户名

          *Minimum length* : 5

          *Maximum length* : 30'
        in: formData
        maxLength: 30
        minLength: 5
        name: username
        required: true
        type: string
      - description: '用户密码

          *Minimum length* : 8

          *Maximum length* : 30'
        in: formData
        maxLength: 30
        minLength: 8
        name: password
        required: true
        type: string
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n       \"code\": 200,\n       \"message\": \"\
            success\",\n       \"data\": {\n        \"uid\": 10,\n        \"username\"\
            : \"aoihosizora\",\n        \"sex\": \"unknown\",\n        \"profile\"\
            : \"\",\n        \"avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\"\
            ,\n        \"birth_time\": \"2000-01-01\",\n        \"authority\": \"\
            normal\"\n        \"phone_number\": \"13512345678\"\n       }\n      \
            \ }\n```"
        '400':
          description: '"request param error" / "request format error"'
        '500':
          description: '"username has been used" / "register failed"'
      summary: 注册
      tags:
      - Authorization
  /raw/image/{uid}/{filename}:
    get:
      consumes:
      - multipart/form-data
      description: 获取用户头像图片以及视频封面
      operationId: -raw-image-{uid}-{filename}-get
      parameters:
      - description: 用户id，或者default
        in: path
        name: uid
        required: true
        type: string
      - description: 图片文件名，jpg后缀名
        in: path
        name: filename
        required: true
        type: string
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n| Key | Value |\n      | --- | --- |\n       | Content-Type\
            \ | image/jpeg |\n```"
        '400':
          description: '"request param error"'
        '404':
          description: '"image not found"'
      summary: 获取图片
      tags:
      - Raw
  /user/:
    delete:
      consumes:
      - multipart/form-data
      description: 删除用户所有信息
      operationId: -user-delete
      parameters:
      - *id001
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            \n}\n```"
        '401': *id002
        '404':
          description: '"user not found"'
        '500':
          description: '"user delete failed"'
      security:
      - basicAuth: ''
      summary: 删除用户
      tags:
      - User
    put:
      consumes:
      - multipart/form-data
      description: 更新用户信息
      operationId: -user-put
      parameters:
      - *id001
      - description: '用户名

          *Minimum length* : 8

          *Maximum length* : 30'
        in: formData
        maxLength: 30
        minLength: 8
        name: username
        required: true
        type: string
      - description: 用户性别
        enum:
        - male
        - female
        - unknown
        in: formData
        name: sex
        required: true
        type: string
      - description: '用户简介

          *Minimum length* : 0

          *Maximum length* : 255'
        in: formData
        maxLength: 255
        minLength: 0
        name: profile
        required: true
        type: string
      - description: 用户生日，固定格式为2000-01-01
        in: formData
        name: birth_time
        required: true
        type: string
      - description: 用户手机号码
        in: formData
        name: phone_number
        required: true
        type: string
      - description: 用户头像，默认不修改
        in: formData
        name: avatar
        required: false
        type: file
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"uid\": 10,\n        \"username\": \"aoihosizora\"\
            ,\n        \"sex\": \"male\",\n        \"profile\": \"Demo Profile\",\n\
            \        \"avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\"\
            ,\n        \"birth_time\": \"2019-12-26\",\n        \"authority\": \"\
            admin\",\n        \"phone_number\": \"13512345678\"\n    }\n}\n```"
        '400':
          description: '"request param error" / "request format error" / "request
            body too large" / "username has been used" / "image type not supported"'
        '401': *id002
        '404':
          description: '"user not found"'
        '500':
          description: '"image save failed" / "user update failed"'
      security:
      - basicAuth: ''
      summary: 更新用户
      tags:
      - User
  /user/subscribing?to:
    delete:
      consumes:
      - multipart/form-data
      description: 取消关注某一用户
      operationId: -user-subscribing?to-delete
      parameters:
      - *id001
      - description: 取消关注用户id
        in: query
        name: to
        required: true
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"me_uid\": 10,\n        \"to_uid\": 3,\n\
            \        \"action\": \"unsubscribe\"\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '401': *id002
        '404':
          description: '"user not found"'
        '500':
          description: '"unsubscribe failed"'
      security:
      - basicAuth: ''
      summary: 取消关注用户
      tags:
      - Subscribe
    put:
      consumes:
      - multipart/form-data
      description: 关注某一用户
      operationId: -user-subscribing?to-put
      parameters:
      - *id001
      - description: 关注用户id
        in: query
        name: to
        required: true
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"me_uid\": 10,\n        \"to_uid\": 3,\n\
            \        \"action\": \"subscribe\"\n    }\n}\n```"
        '400':
          description: '"request param error" / "subscribe oneself invalid"'
        '401': *id002
        '404':
          description: '"user not found"'
        '500':
          description: '"subscribe failed"'
      security:
      - basicAuth: ''
      summary: 关注用户
      tags:
      - Subscribe
  /user/{uid}:
    get:
      consumes:
      - multipart/form-data
      description: 查询用户信息
      operationId: -user-{uid}-get
      parameters:
      - description: 用户id
        in: path
        name: uid
        required: true
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n       \"code\": 200,\n       \"message\": \"\
            success\",\n       \"data\": {\n        \"user\": {\n         \"uid\"\
            : 10,\n         \"username\": \"aoihosizora\",\n         \"sex\": \"male\"\
            ,\n         \"profile\": \"Demo Profile\",\n         \"avatar_url\": \"\
            http://localhost:3344/raw/image/default/avatar.jpg\",\n         \"birth_time\"\
            : \"2019-12-26\",\n         \"authority\": \"admin\"\n         \"phone_number\"\
            : \"13512345678\"\n        },\n        \"extra\": {\n         \"subscribing_cnt\"\
            : 3,\n         \"subscriber_cnt\": 2,\n         \"video_cnt\": 3,\n  \
            \       \"playlist_cnt\": 0\n        }\n       }\n       }\n```"
        '400':
          description: '"request param error"'
        '404':
          description: '"user not found"'
      summary: 查询用户
      tags:
      - User
  /user/{uid}/subscriber:
    get:
      consumes:
      - multipart/form-data
      description: 查询用户所有粉丝，返回分页数据
      operationId: -user-{uid}-subscriber-get
      parameters:
      - description: 查询的用户id
        in: path
        name: uid
        required: true
        type: integer
      - description: 分页
        in: query
        name: page
        required: false
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"count\": 1,\n        \"page\": 1,\n    \
            \    \"data\": [\n            {\n                \"uid\": 2,\n       \
            \         \"username\": \"User2\",\n                \"sex\": \"unknown\"\
            ,\n                \"profile\": \"\",\n                \"avatar_url\"\
            : \"http://localhost:3344/raw/image/default/avatar.jpg\",\n          \
            \      \"birth_time\": \"2000-01-01\",\n                \"authority\"\
            : \"normal\"\n            }\n        ]\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '404':
          description: '"user not found"'
      summary: 用户粉丝
      tags:
      - Subscribe
  /user/{uid}/subscribing:
    get:
      consumes:
      - multipart/form-data
      description: 查询用户所有关注，返回分页数据
      operationId: -user-{uid}-subscribing-get
      parameters:
      - description: 查询的用户id
        in: path
        name: uid
        required: true
        type: integer
      - description: 分页
        in: query
        name: page
        required: false
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"count\": 1,\n        \"page\": 1,\n    \
            \    \"data\": [\n            {\n                \"uid\": 1,\n       \
            \         \"username\": \"User1\",\n                \"sex\": \"male\"\
            ,\n                \"profile\": \"\",\n                \"avatar_url\"\
            : \"http://localhost:3344/raw/image/default/avatar.jpg\",\n          \
            \      \"birth_time\": \"2000-01-01\",\n                \"authority\"\
            : \"admin\"\n            }\n        ]\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '404':
          description: '"user not found"'
      summary: 用户关注
      tags:
      - Subscribe
  /user/{uid}/video?page:
    get:
      consumes:
      - multipart/form-data
      description: 查询作者为用户的所有视频，返回分页数据
      operationId: -user-{uid}-video?page-get
      parameters:
      - description: 用户id
        in: path
        name: uid
        required: true
        type: integer
      - description: 分页
        in: query
        name: page
        required: false
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"count\": 1,\n        \"page\": 1,\n    \
            \    \"data\": [\n            {\n                \"vid\": 10,\n      \
            \          \"title\": \"Video Title\",\n                \"description\"\
            : \"Video Demo Description\",\n                \"video_url\": \"\",\n\
            \                \"cover_url\": \"http://localhost:3344/raw/image/default/cover.jpg\"\
            ,\n                \"upload_time\": \"2019-12-26 14:14:04\",\n       \
            \         \"update_time\": \"2019-12-30 21:04:51\",\n                \"\
            author\": {\n                    \"uid\": 10,\n                    \"\
            username\": \"aoihosizora\",\n                    \"sex\": \"male\",\n\
            \                    \"profile\": \"Demo Profile\",\n                \
            \    \"avatar_url\": \"http://localhost:3344/raw/image/10/avatar_20191230205334869693.jpg\"\
            ,\n                    \"birth_time\": \"2019-12-26\",\n             \
            \       \"authority\": \"admin\"\n                }\n            }\n \
            \       ]\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '404':
          description: '"user not found"'
      summary: 查询用户视频
      tags:
      - Video
  /user?page:
    get:
      consumes:
      - multipart/form-data
      description: 管理员查询所有用户，返回分页数据，Admin
      operationId: -user?page-get
      parameters:
      - *id001
      - description: 分页
        in: query
        name: page
        required: false
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"count\": 1,\n        \"page\": 1,\n    \
            \    \"data\": [\n            {\n                \"uid\": 10,\n      \
            \          \"username\": \"aoihosizora\",\n                \"sex\": \"\
            male\",\n                \"profile\": \"Demo Profile\",\n            \
            \    \"avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\"\
            ,\n                \"birth_time\": \"2019-12-26\",\n                \"\
            authority\": \"admin\"\n            }\n        ]\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '401': *id002
      security:
      - basicAuth: ''
      summary: 查询所有用户
      tags:
      - User
      - Administration
  /video/:
    post:
      consumes:
      - multipart/form-data
      description: 新建用户视频
      operationId: -video-post
      parameters:
      - *id001
      - description: '视频标题

          *Minimum length* : 5

          *Maximum length* : 100'
        in: formData
        maxLength: 100
        minLength: 5
        name: title
        required: true
        type: string
      - description: '视频简介

          *Minimum length* : 0

          *Maximum length* : 255'
        in: formData
        maxLength: 255
        minLength: 0
        name: description
        required: true
        type: string
      - description: 视频资源链接
        in: formData
        name: video_url
        required: true
        type: string
      - description: 视频封面
        in: formData
        name: cover
        required: false
        type: file
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"vid\": 10,\n        \"title\": \"Video Title\"\
            ,\n        \"description\": \"Video Demo Description\",\n        \"video_url\"\
            : \"\",\n        \"cover_url\": \"http://localhost:3344/raw/image/default/cover.jpg\"\
            ,\n        \"upload_time\": \"2019-12-26 14:14:04\",\n        \"update_time\"\
            : \"2019-12-30 21:04:51\",\n        \"author\": {\n            \"uid\"\
            : 10,\n            \"username\": \"aoihosizora\",\n            \"sex\"\
            : \"male\",\n            \"profile\": \"Demo Profile\",\n            \"\
            avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\",\n\
            \            \"birth_time\": \"2019-12-26\",\n            \"authority\"\
            : \"admin\"\n        }\n    }\n}\n```"
        '400':
          description: '"request param error" / "request format error" / "request
            body too large" / "image type not supported" / "video resource has been
            used"'
        '401': *id002
        '500':
          description: '"image save failed" / "video insert failed"'
      security:
      - basicAuth: ''
      summary: 新建视频
      tags:
      - Video
  /video/{vid}:
    delete:
      consumes:
      - multipart/form-data
      description: 删除用户视频
      operationId: -video-{vid}-delete
      parameters:
      - *id001
      - description: 删除视频id
        in: path
        name: vid
        required: true
        type: string
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            \n}\n```"
        '400':
          description: '"request param error"'
        '401': *id002
        '404':
          description: '"video not found"'
        '500':
          description: '"video delete failed"'
      security:
      - basicAuth: ''
      summary: 删除视频
      tags:
      - Video
    get:
      consumes:
      - multipart/form-data
      description: 查询视频信息
      operationId: -video-{vid}-get
      parameters:
      - description: 视频id
        in: path
        name: vid
        required: true
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"vid\": 10,\n        \"title\": \"Video Title\"\
            ,\n        \"description\": \"Video Demo Description\",\n        \"video_url\"\
            : \"\",\n        \"cover_url\": \"http://localhost:3344/raw/image/default/cover.jpg\"\
            ,\n        \"upload_time\": \"2019-12-26 14:14:04\",\n        \"update_time\"\
            : \"2019-12-30 21:04:51\",\n        \"author\": {\n            \"uid\"\
            : 10,\n            \"username\": \"aoihosizora\",\n            \"sex\"\
            : \"male\",\n            \"profile\": \"Demo Profile\",\n            \"\
            avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\",\n\
            \            \"birth_time\": \"2019-12-26\",\n            \"authority\"\
            : \"admin\"\n        }\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '404':
          description: '"video not found"'
      summary: 查询视频
      tags:
      - Video
    post:
      consumes:
      - multipart/form-data
      description: 更新用户视频信息
      operationId: -video-{vid}-post
      parameters:
      - *id001
      - description: 更新视频id
        in: path
        name: vid
        required: true
        type: string
      - description: '视频标题

          *Minimum length* : 5

          *Maximum length* : 100'
        in: formData
        maxLength: 100
        minLength: 5
        name: title
        required: false
        type: string
      - description: '视频简介

          *Minimum length* : 0

          *Maximum length* : 255'
        in: formData
        maxLength: 255
        minLength: 0
        name: description
        required: false
        type: string
      - description: 视频封面
        in: formData
        name: cover
        required: false
        type: file
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"vid\": 10,\n        \"title\": \"Video Title\"\
            ,\n        \"description\": \"Video Demo Description\",\n        \"video_url\"\
            : \"\",\n        \"cover_url\": \"http://localhost:3344/raw/image/10/cover_20191230210451040811.jpg\"\
            ,\n        \"upload_time\": \"2019-12-26 14:14:04\",\n        \"update_time\"\
            : \"2019-12-30 21:04:51\",\n        \"author\": {\n            \"uid\"\
            : 10,\n            \"username\": \"aoihosizora\",\n            \"sex\"\
            : \"male\",\n            \"profile\": \"Demo Profile\",\n            \"\
            avatar_url\": \"http://localhost:3344/raw/image/default/avatar.jpg\",\n\
            \            \"birth_time\": \"2019-12-26\",\n            \"authority\"\
            : \"admin\"\n        }\n    }\n}\n```"
        '400':
          description: '"request param error" / "request format error" / "request
            body too large" / "image type not supported"'
        '401': *id002
        '404':
          description: '"video not found"'
        '500':
          description: '"image save failed" / "video update failed"'
      security:
      - basicAuth: ''
      summary: 更新视频
      tags:
      - Video
  /video?page:
    get:
      consumes:
      - multipart/form-data
      description: 管理员查询所有视频，返回分页数据，Admin
      operationId: -video?page-get
      parameters:
      - *id001
      - description: 分页
        in: query
        name: page
        required: false
        type: integer
      produces:
      - application/json
      responses:
        '200':
          description: "```json\n{\n    \"code\": 200,\n    \"message\": \"success\"\
            ,\n    \"data\": {\n        \"count\": 1,\n        \"page\": 1,\n    \
            \    \"data\": [\n            {\n                \"vid\": 10,\n      \
            \          \"title\": \"Video Title\",\n                \"description\"\
            : \"Video Demo Description\",\n                \"video_url\": \"\",\n\
            \                \"cover_url\": \"http://localhost:3344/raw/image/default/cover.jpg\"\
            ,\n                \"upload_time\": \"2019-12-26 14:14:04\",\n       \
            \         \"update_time\": \"2019-12-30 21:04:51\",\n                \"\
            author\": {\n                    \"uid\": 10,\n                    \"\
            username\": \"aoihosizora\",\n                    \"sex\": \"male\",\n\
            \                    \"profile\": \"Demo Profile\",\n                \
            \    \"avatar_url\": \"http://localhost:3344/raw/image/10/avatar_20191230205334869693.jpg\"\
            ,\n                    \"birth_time\": \"2019-12-26\",\n             \
            \       \"authority\": \"admin\"\n                }\n            }\n \
            \       ]\n    }\n}\n```"
        '400':
          description: '"request param error"'
        '401': *id002
      security:
      - basicAuth: ''
      summary: 查询所有视频
      tags:
      - Video
      - Administration
swagger: '2.0'
